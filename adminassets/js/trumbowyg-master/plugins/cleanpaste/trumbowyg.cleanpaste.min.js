(function($){"use strict";function checkValidTags(snippet){var theString=snippet;theString=theString.replace(/<[^> ]*/g,function(match){return match.toLowerCase()});theString=theString.replace(/<[^>]*>/g,function(match){match=match.replace(/ [^=]+=/g,function(match2){return match2.toLowerCase()});return match});theString=theString.replace(/<[^>]*>/g,function(match){match=match.replace(/( [^=]+=)([^"][^ >]*)/g,'$1"$2"');return match});return theString}function cleanIt(html){html=checkValidTags(html);html=html.replace(/<b(\s+|>)/g,"<strong$1");html=html.replace(/<\/b(\s+|>)/g,"</strong$1");html=html.replace(/<i(\s+|>)/g,"<em$1");html=html.replace(/<\/i(\s+|>)/g,"</em$1");html=html.replace(/<!(?:--[\s\S]*?--\s*)?>\s*/g,"");html=html.replace(/&nbsp;/gi," ");html=html.replace(/ <\//gi,"</");html.replace(/\s+/g," ");html=html.replace(/^\s*|\s*$/g,"");html=html.replace(/<[^>]*>/g,function(match){match=match.replace(/ ([^=]+)="[^"]*"/g,function(match2,attributeName){if(["alt","href","src","title"].indexOf(attributeName)!==-1){return match2}return""});return match});html=html.replace(/<\?xml[^>]*>/g,"");html=html.replace(/<[^ >]+:[^>]*>/g,"");html=html.replace(/<\/[^ >]+:[^>]*>/g,"");html=html.replace(/<(div|span|style|meta|link).*?>/gi,"");return html}$.extend(true,$.trumbowyg,{plugins:{cleanPaste:{init:function(trumbowyg){trumbowyg.pasteHandlers.push(function(pasteEvent){setTimeout(function(){try{trumbowyg.saveRange();var clipboardData=(pasteEvent.originalEvent||pasteEvent).clipboardData,pastedData=clipboardData.getData("Text"),node=trumbowyg.doc.getSelection().focusNode,range=trumbowyg.doc.createRange(),cleanedPaste=cleanIt(pastedData.trim()),newNode=$(cleanedPaste)[0]||trumbowyg.doc.createTextNode(cleanedPaste);if(trumbowyg.$ed.html()===""){trumbowyg.$ed[0].appendChild(newNode)}else{range.setStartAfter(node);range.setEndAfter(node);trumbowyg.doc.getSelection().removeAllRanges();trumbowyg.doc.getSelection().addRange(range);trumbowyg.range.insertNode(newNode)}range=trumbowyg.doc.createRange();range.setStartAfter(newNode);range.setEndAfter(newNode);trumbowyg.doc.getSelection().removeAllRanges();trumbowyg.doc.getSelection().addRange(range);pasteEvent.stopPropagation();pasteEvent.preventDefault();trumbowyg.saveRange();trumbowyg.syncCode();trumbowyg.$c.trigger("tbwchange")}catch(c){}},0)})}}}})})(jQuery);